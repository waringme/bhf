swagger: "2.0"
info:
  title: "Business Current Account Application API"
  description: "REST API for SME Business Current Account Application Form"
  version: "1.0.0"
  contact:
    name: "Banking API Support"
    email: "api-support@bank.com"

host: "api.lloydsbank.com"
basePath: "/api/v1/applications"
schemes:
  - https

consumes:
  - application/json
  - multipart/form-data
produces:
  - application/json

securityDefinitions:
  apiKey:
    type: apiKey
    name: X-API-Key
    in: header
  oauth2:
    type: oauth2
    flow: application
    tokenUrl: https://api.lloydsbank.com/oauth/token

paths:
  /business-account:
    post:
      summary: "Submit Business Current Account Application"
      description: "Creates a new business current account application for SME"
      operationId: "submitBusinessAccountApplication"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: application
          description: "Business account application data"
          required: true
          schema:
            $ref: "#/definitions/BusinessAccountApplication"
      responses:
        201:
          description: "Application submitted successfully"
          schema:
            $ref: "#/definitions/ApplicationResponse"
        400:
          description: "Invalid application data"
          schema:
            $ref: "#/definitions/ErrorResponse"
        422:
          description: "Validation error"
          schema:
            $ref: "#/definitions/ValidationErrorResponse"
        500:
          description: "Internal server error"
      security:
        - apiKey: []
  
  /business-account/{applicationId}:
    get:
      summary: "Get application status"
      description: "Retrieves the status of a business account application"
      operationId: "getApplicationStatus"
      produces:
        - application/json
      parameters:
        - name: applicationId
          in: path
          description: "Application ID"
          required: true
          type: string
      responses:
        200:
          description: "Application found"
          schema:
            $ref: "#/definitions/ApplicationStatusResponse"
        404:
          description: "Application not found"
        500:
          description: "Internal server error"
      security:
        - apiKey: []
    
    put:
      summary: "Update application"
      description: "Updates an existing business account application"
      operationId: "updateBusinessAccountApplication"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: applicationId
          in: path
          description: "Application ID"
          required: true
          type: string
        - in: body
          name: application
          description: "Updated application data"
          required: true
          schema:
            $ref: "#/definitions/BusinessAccountApplication"
      responses:
        200:
          description: "Application updated successfully"
          schema:
            $ref: "#/definitions/ApplicationResponse"
        404:
          description: "Application not found"
        500:
          description: "Internal server error"
      security:
        - apiKey: []

  /business-account/{applicationId}/documents:
    post:
      summary: "Upload supporting documents"
      description: "Upload documents for business account application"
      operationId: "uploadDocuments"
      consumes:
        - multipart/form-data
      produces:
        - application/json
      parameters:
        - name: applicationId
          in: path
          description: "Application ID"
          required: true
          type: string
        - name: documentType
          in: formData
          description: "Type of document"
          required: true
          type: string
          enum:
            - proof_of_identity
            - proof_of_address
            - company_registration
            - business_plan
            - financial_statements
            - other
        - name: file
          in: formData
          description: "Document file"
          required: true
          type: file
      responses:
        200:
          description: "Document uploaded successfully"
          schema:
            $ref: "#/definitions/DocumentUploadResponse"
        400:
          description: "Invalid document"
        500:
          description: "Internal server error"
      security:
        - apiKey: []

  /business-account/validate:
    post:
      summary: "Validate application data"
      description: "Validates business account application data before submission"
      operationId: "validateApplication"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: application
          description: "Application data to validate"
          required: true
          schema:
            $ref: "#/definitions/BusinessAccountApplication"
      responses:
        200:
          description: "Validation successful"
          schema:
            $ref: "#/definitions/ValidationResponse"
        422:
          description: "Validation failed"
          schema:
            $ref: "#/definitions/ValidationErrorResponse"
      security:
        - apiKey: []

  /lookup/company:
    get:
      summary: "Lookup company details"
      description: "Retrieves company information from Companies House"
      operationId: "lookupCompany"
      produces:
        - application/json
      parameters:
        - name: registrationNumber
          in: query
          description: "Company registration number"
          required: true
          type: string
      responses:
        200:
          description: "Company found"
          schema:
            $ref: "#/definitions/CompanyLookupResponse"
        404:
          description: "Company not found"
      security:
        - apiKey: []

  /lookup/sort-code:
    get:
      summary: "Validate sort code"
      description: "Validates UK bank sort code"
      operationId: "validateSortCode"
      produces:
        - application/json
      parameters:
        - name: sortCode
          in: query
          description: "6-digit sort code"
          required: true
          type: string
          pattern: "^[0-9]{6}$"
      responses:
        200:
          description: "Sort code valid"
          schema:
            $ref: "#/definitions/SortCodeResponse"
        400:
          description: "Invalid sort code"
      security:
        - apiKey: []

definitions:
  BusinessAccountApplication:
    type: object
    required:
      - businessDetails
      - contactDetails
      - applicantDetails
      - accountPreferences
      - declaration
    properties:
      applicationId:
        type: string
        description: "Unique application identifier (auto-generated)"
        example: "BCA-SME-2024-001234"
      businessDetails:
        $ref: "#/definitions/BusinessDetails"
      contactDetails:
        $ref: "#/definitions/ContactDetails"
      applicantDetails:
        type: array
        description: "Details of applicants (directors/beneficial owners)"
        minItems: 1
        maxItems: 10
        items:
          $ref: "#/definitions/ApplicantDetails"
      accountPreferences:
        $ref: "#/definitions/AccountPreferences"
      financialInformation:
        $ref: "#/definitions/FinancialInformation"
      expectedActivity:
        $ref: "#/definitions/ExpectedActivity"
      declaration:
        $ref: "#/definitions/Declaration"
      marketingPreferences:
        $ref: "#/definitions/MarketingPreferences"
      submissionDate:
        type: string
        format: date-time
        description: "Application submission timestamp"

  BusinessDetails:
    type: object
    required:
      - businessName
      - businessType
      - registrationNumber
      - dateOfIncorporation
      - businessAddress
      - industry
    properties:
      businessName:
        type: string
        description: "Legal business name"
        example: "ABC Trading Limited"
        minLength: 2
        maxLength: 100
      tradingName:
        type: string
        description: "Trading name (if different)"
        example: "ABC Shop"
        maxLength: 100
      businessType:
        type: string
        description: "Type of business entity"
        enum:
          - sole_trader
          - partnership
          - limited_company
          - limited_liability_partnership
          - charity
          - community_interest_company
          - other
      registrationNumber:
        type: string
        description: "Company registration number (Companies House)"
        example: "12345678"
        pattern: "^[A-Z0-9]{8}$"
      dateOfIncorporation:
        type: string
        format: date
        description: "Date of business incorporation/registration"
        example: "2020-01-15"
      vatRegistered:
        type: boolean
        description: "Is the business VAT registered?"
        default: false
      vatNumber:
        type: string
        description: "VAT registration number"
        example: "GB123456789"
        pattern: "^GB[0-9]{9}$"
      businessAddress:
        $ref: "#/definitions/Address"
      tradingAddress:
        $ref: "#/definitions/Address"
        description: "Trading address (if different from registered)"
      industry:
        type: string
        description: "Industry sector"
        enum:
          - retail
          - hospitality
          - construction
          - manufacturing
          - technology
          - professional_services
          - healthcare
          - education
          - transport
          - agriculture
          - real_estate
          - financial_services
          - other
      businessDescription:
        type: string
        description: "Brief description of business activities"
        example: "Retail of electronic goods"
        maxLength: 500
      numberOfEmployees:
        type: integer
        description: "Number of employees"
        minimum: 0
        maximum: 9999
      website:
        type: string
        format: uri
        description: "Business website URL"
        example: "https://www.abctrading.co.uk"

  ContactDetails:
    type: object
    required:
      - primaryContactName
      - primaryEmail
      - primaryPhone
    properties:
      primaryContactName:
        type: string
        description: "Primary contact person name"
        example: "John Smith"
        minLength: 2
        maxLength: 100
      primaryEmail:
        type: string
        format: email
        description: "Primary email address"
        example: "john.smith@abctrading.co.uk"
      primaryPhone:
        type: string
        description: "Primary phone number"
        example: "+44 7700 900123"
        pattern: "^\\+?44[0-9]{10}$"
      mobilePhone:
        type: string
        description: "Mobile phone number"
        example: "+44 7700 900123"
      preferredContactMethod:
        type: string
        enum:
          - email
          - phone
          - post
        default: "email"
      preferredContactTime:
        type: string
        enum:
          - morning
          - afternoon
          - evening
          - anytime

  ApplicantDetails:
    type: object
    required:
      - role
      - title
      - firstName
      - lastName
      - dateOfBirth
      - nationality
      - residentialAddress
      - emailAddress
      - phoneNumber
    properties:
      role:
        type: string
        description: "Role in the business"
        enum:
          - director
          - partner
          - sole_trader
          - beneficial_owner
          - authorized_signatory
      title:
        type: string
        enum:
          - Mr
          - Mrs
          - Miss
          - Ms
          - Dr
          - Prof
          - Other
      firstName:
        type: string
        description: "First name"
        example: "John"
        minLength: 1
        maxLength: 50
      middleName:
        type: string
        description: "Middle name(s)"
        maxLength: 50
      lastName:
        type: string
        description: "Last name"
        example: "Smith"
        minLength: 1
        maxLength: 50
      dateOfBirth:
        type: string
        format: date
        description: "Date of birth"
        example: "1980-05-15"
      nationality:
        type: string
        description: "Nationality (ISO 3166-1 alpha-2)"
        example: "GB"
        pattern: "^[A-Z]{2}$"
      nationalInsuranceNumber:
        type: string
        description: "National Insurance Number"
        example: "AB123456C"
        pattern: "^[A-Z]{2}[0-9]{6}[A-Z]$"
      residentialAddress:
        $ref: "#/definitions/Address"
      previousAddresses:
        type: array
        description: "Previous addresses (if at current address < 3 years)"
        items:
          $ref: "#/definitions/PreviousAddress"
      emailAddress:
        type: string
        format: email
        description: "Email address"
        example: "john.smith@email.com"
      phoneNumber:
        type: string
        description: "Phone number"
        example: "+44 7700 900123"
      taxResident:
        type: boolean
        description: "UK tax resident?"
        default: true
      ownership:
        type: number
        format: double
        description: "Percentage ownership in business"
        minimum: 0
        maximum: 100
        example: 25.0
      politicallyExposed:
        type: boolean
        description: "Is this person a Politically Exposed Person (PEP)?"
        default: false
      pepDetails:
        type: string
        description: "Details if politically exposed"
        maxLength: 500

  Address:
    type: object
    required:
      - addressLine1
      - city
      - postcode
      - country
    properties:
      addressLine1:
        type: string
        description: "Address line 1"
        example: "123 High Street"
        maxLength: 100
      addressLine2:
        type: string
        description: "Address line 2"
        maxLength: 100
      addressLine3:
        type: string
        description: "Address line 3"
        maxLength: 100
      city:
        type: string
        description: "City/Town"
        example: "London"
        maxLength: 50
      county:
        type: string
        description: "County"
        example: "Greater London"
        maxLength: 50
      postcode:
        type: string
        description: "Postcode"
        example: "SW1A 1AA"
        pattern: "^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$"
      country:
        type: string
        description: "Country code (ISO 3166-1 alpha-2)"
        example: "GB"
        default: "GB"

  PreviousAddress:
    allOf:
      - $ref: "#/definitions/Address"
      - type: object
        properties:
          dateFrom:
            type: string
            format: date
            description: "Start date at this address"
          dateTo:
            type: string
            format: date
            description: "End date at this address"

  AccountPreferences:
    type: object
    required:
      - accountType
      - branchPreference
    properties:
      accountType:
        type: string
        description: "Type of business account"
        enum:
          - business_current_account
          - business_current_account_plus
          - club_charity_account
          - community_account
      branchPreference:
        type: string
        description: "Preferred branch sort code"
        example: "309430"
        pattern: "^[0-9]{6}$"
      overdraftRequired:
        type: boolean
        description: "Is an overdraft facility required?"
        default: false
      overdraftAmount:
        type: number
        format: double
        description: "Overdraft amount requested (GBP)"
        minimum: 0
        maximum: 1000000
      debitCardRequired:
        type: boolean
        description: "Business debit card required?"
        default: true
      numberOfCards:
        type: integer
        description: "Number of debit cards needed"
        minimum: 0
        maximum: 10
        default: 1
      onlineBankingRequired:
        type: boolean
        description: "Online banking access required?"
        default: true
      mobileBankingRequired:
        type: boolean
        description: "Mobile banking access required?"
        default: true
      chequeBookRequired:
        type: boolean
        description: "Cheque book required?"
        default: false

  FinancialInformation:
    type: object
    properties:
      annualTurnover:
        type: number
        format: double
        description: "Expected annual turnover (GBP)"
        minimum: 0
        example: 250000
      projectedTurnover:
        type: number
        format: double
        description: "Projected turnover for next year (GBP)"
        minimum: 0
      sourceOfFunds:
        type: string
        description: "Primary source of business funds"
        enum:
          - sales_revenue
          - investment
          - loans
          - grants
          - personal_funds
          - other
      otherSourceOfFunds:
        type: string
        description: "Details if source is 'other'"
        maxLength: 200
      existingBankAccounts:
        type: array
        description: "Details of existing business bank accounts"
        items:
          $ref: "#/definitions/ExistingBankAccount"

  ExistingBankAccount:
    type: object
    properties:
      bankName:
        type: string
        description: "Name of bank"
        example: "Lloyds Bank"
      accountNumber:
        type: string
        description: "Account number"
        pattern: "^[0-9]{8}$"
      sortCode:
        type: string
        description: "Sort code"
        pattern: "^[0-9]{6}$"
      accountType:
        type: string
        enum:
          - current_account
          - savings_account
          - loan_account

  ExpectedActivity:
    type: object
    required:
      - monthlyCredits
      - monthlyDebits
      - monthlyTransactions
    properties:
      monthlyCredits:
        type: integer
        description: "Expected number of monthly credits"
        minimum: 0
        example: 50
      monthlyDebits:
        type: integer
        description: "Expected number of monthly debits"
        minimum: 0
        example: 100
      monthlyTransactions:
        type: integer
        description: "Total expected monthly transactions"
        minimum: 0
        example: 150
      averageTransactionValue:
        type: number
        format: double
        description: "Average transaction value (GBP)"
        minimum: 0
        example: 500
      cashDeposits:
        type: boolean
        description: "Will you be making cash deposits?"
        default: false
      cashDepositFrequency:
        type: string
        enum:
          - daily
          - weekly
          - monthly
          - rarely
      internationalPayments:
        type: boolean
        description: "Will you make international payments?"
        default: false
      internationalPaymentCountries:
        type: array
        description: "Countries for international payments"
        items:
          type: string
          description: "Country code (ISO 3166-1 alpha-2)"

  Declaration:
    type: object
    required:
      - termsAccepted
      - informationAccurate
      - authorizedToApply
      - signatureName
      - signatureDate
    properties:
      termsAccepted:
        type: boolean
        description: "Terms and conditions accepted"
        enum: [true]
      informationAccurate:
        type: boolean
        description: "Declaration that information provided is accurate"
        enum: [true]
      authorizedToApply:
        type: boolean
        description: "Authorized to apply on behalf of business"
        enum: [true]
      creditCheckConsent:
        type: boolean
        description: "Consent to credit checks"
        enum: [true]
      signatureName:
        type: string
        description: "Full name of person signing"
        minLength: 2
        maxLength: 100
      signatureDate:
        type: string
        format: date
        description: "Date of signature"
      ipAddress:
        type: string
        description: "IP address of applicant"
        example: "192.168.1.1"
      userAgent:
        type: string
        description: "Browser user agent"

  MarketingPreferences:
    type: object
    properties:
      emailMarketing:
        type: boolean
        description: "Consent to email marketing"
        default: false
      smsMarketing:
        type: boolean
        description: "Consent to SMS marketing"
        default: false
      phoneMarketing:
        type: boolean
        description: "Consent to phone marketing"
        default: false
      postMarketing:
        type: boolean
        description: "Consent to postal marketing"
        default: false
      partnerMarketing:
        type: boolean
        description: "Consent to partner marketing"
        default: false

  ApplicationResponse:
    type: object
    properties:
      success:
        type: boolean
        description: "Application submission success"
        example: true
      applicationId:
        type: string
        description: "Unique application ID"
        example: "BCA-SME-2024-001234"
      referenceNumber:
        type: string
        description: "Application reference number"
        example: "REF-123456789"
      status:
        type: string
        enum:
          - submitted
          - under_review
          - pending_documents
          - approved
          - declined
          - withdrawn
      message:
        type: string
        description: "Response message"
        example: "Your application has been submitted successfully"
      submissionDate:
        type: string
        format: date-time
        description: "Submission timestamp"
      nextSteps:
        type: array
        description: "Next steps for the applicant"
        items:
          type: string
      estimatedDecisionDate:
        type: string
        format: date
        description: "Estimated decision date"

  ApplicationStatusResponse:
    type: object
    properties:
      applicationId:
        type: string
        description: "Application ID"
      status:
        type: string
        enum:
          - submitted
          - under_review
          - pending_documents
          - approved
          - declined
          - withdrawn
      statusMessage:
        type: string
        description: "Current status message"
      lastUpdated:
        type: string
        format: date-time
        description: "Last update timestamp"
      documentsRequired:
        type: array
        description: "List of documents still required"
        items:
          type: string
      accountNumber:
        type: string
        description: "Account number (if approved)"
      sortCode:
        type: string
        description: "Sort code (if approved)"

  DocumentUploadResponse:
    type: object
    properties:
      success:
        type: boolean
      documentId:
        type: string
        description: "Unique document ID"
      fileName:
        type: string
        description: "Uploaded file name"
      fileSize:
        type: integer
        description: "File size in bytes"
      uploadDate:
        type: string
        format: date-time
      message:
        type: string

  ValidationResponse:
    type: object
    properties:
      valid:
        type: boolean
        description: "Overall validation result"
      errors:
        type: array
        items:
          $ref: "#/definitions/ValidationError"
      warnings:
        type: array
        items:
          $ref: "#/definitions/ValidationWarning"

  ValidationError:
    type: object
    properties:
      field:
        type: string
        description: "Field name with error"
      code:
        type: string
        description: "Error code"
      message:
        type: string
        description: "Error message"

  ValidationWarning:
    type: object
    properties:
      field:
        type: string
      message:
        type: string

  ValidationErrorResponse:
    type: object
    properties:
      success:
        type: boolean
        example: false
      message:
        type: string
        example: "Validation failed"
      errors:
        type: array
        items:
          $ref: "#/definitions/ValidationError"

  ErrorResponse:
    type: object
    properties:
      success:
        type: boolean
        example: false
      errorCode:
        type: string
        description: "Error code"
      message:
        type: string
        description: "Error message"
      timestamp:
        type: string
        format: date-time

  CompanyLookupResponse:
    type: object
    properties:
      success:
        type: boolean
      companyName:
        type: string
      companyNumber:
        type: string
      companyStatus:
        type: string
      incorporationDate:
        type: string
        format: date
      companyType:
        type: string
      registeredAddress:
        $ref: "#/definitions/Address"
      directors:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            appointedDate:
              type: string
              format: date

  SortCodeResponse:
    type: object
    properties:
      valid:
        type: boolean
      sortCode:
        type: string
      branchName:
        type: string
      branchAddress:
        type: string

